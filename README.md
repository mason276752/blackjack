# 21點遊戲 (Blackjack Game)

**[English](./README.en.md) | 繁體中文 | [한국어](./README.ko.md) | [Filipino](./README.fil.md)**

---

一個功能完整的網頁版21點模擬器，具備 AI 自動遊玩、多種算牌系統、策略偏差提示和全面的規則自訂功能。使用 React、TypeScript 和 Vite 建構。

## 線上體驗

🎮 **[立即遊玩](https://mason276752.github.io/blackjack/)**

## 功能特色

### 核心遊戲玩法
- **完整21點實作**：標準21點玩法，包含補牌(Hit)、停牌(Stand)、加倍(Double Down)、分牌(Split)、投降(Surrender)
- **自訂規則**：豐富的規則配置，包括牌組數量、莊家行為、賠率等
- **多種規則預設**：快速設定拉斯維加斯大道、大西洋城、歐洲等地區變體
- **真實莊家 AI**：模擬真實莊家行為，可配置補牌/停牌規則
- **保險功能**：莊家明牌為 A 時可購買保險，手動或自動決策

### 算牌系統（5種系統）
- **Hi-Lo**（平衡系統，推薦初學者）
  - 配對策略：Illustrious 18（18個關鍵偏差）
  - 下注相關性：0.97 | 遊玩效率：0.51
- **KO（敲除系統）**（不平衡系統）
  - 配對策略：KO Preferred（14個優化偏差）
  - 下注相關性：0.98 | 遊玩效率：0.55
- **Omega II**（進階多級系統）
  - 配對策略：Omega II Matrix（17個進階索引）
  - 下注相關性：0.99 | 遊玩效率：0.67
- **Zen Count**（精確多級系統）
  - 配對策略：Zen Indices（21個精確索引）
  - 下注相關性：0.96 | 遊玩效率：0.63
- **CAC2**（Catch And Count 2）
  - 配對策略：Catch 22（22個策略偏差）
  - 下注相關性：0.98 | 遊玩效率：0.60

**系統策略硬綁定**：每個算牌系統只能搭配其專屬策略，確保最佳準確度

### 策略偏差系統
- **即時偏差提示**：根據真實計數/運行計數顯示策略偏差
- **Index Plays 面板**：顯示當前適用的策略偏差（如：16 vs 10 停牌 at TC+0）
- **智能決策引擎**：AI 自動應用計數系統的專屬策略偏差
- **視覺化指導**：色彩編碼顯示偏差建議（補牌、停牌、加倍、分牌、投降）

### AI 自動遊玩
- **智能決策**：AI 使用基本策略表 + 策略偏差進行最佳遊玩決策
- **動態下注策略**：基於真實計數的實用 1-12 單位下注策略
- **可調速度**：可配置遊戲速度從 50ms 到 2000ms
- **即時決策顯示**：即時查看 AI 每個動作的推理過程
- **統計追蹤**：監控遊玩回合數、決策次數、平均下注額
- **恢復機制**：自動偵測卡死狀態並提供重試功能

### 策略助手
- **互動式策略表**：
  - 硬牌總和（5-20 vs 莊家 2-A）
  - 軟牌總和（A-2 至 A-9 vs 莊家 2-A）
  - 對子分牌（2-2 至 A-A vs 莊家 2-A）
- **視覺化高亮**：當前手牌情況在策略表上高亮顯示
- **動作提示**：色彩編碼建議（補牌、停牌、加倍、分牌、投降）
- **手動標籤切換**：硬牌/軟牌/對子標籤不會自動切換，由使用者控制

### 使用者介面
- **三欄佈局**：策略表（左 520px）、遊戲區域（中）、規則面板（右 400px）
- **響應式設計**：針對桌面和平板優化
- **四語言支援**：完整的英文、繁體中文、韓文、菲律賓語本地化
- **撲克牌圖像**：視覺化撲克牌顯示，包含花色和點數
- **統計儀表板**：追蹤資金、遊玩手數、勝率等

## 技術堆疊

- **React 18.2**：現代 React，使用 Hooks 和 Context
- **TypeScript 5.2**：完整的類型安全
- **Vite 5.2**：快速開發和優化的生產構建
- **i18next**：國際化支援與語言檢測
- **ESLint**：程式碼品質和一致性

## 專案結構

```
src/
├── components/
│   ├── ai/              # AI 控制面板和 UI
│   ├── common/          # 可重用元件（語言切換器等）
│   ├── counting/        # 算牌顯示和選擇器
│   ├── game/            # 核心遊戲 UI（遊戲板、卡牌、控制）
│   ├── layout/          # 佈局元件（標題、網格）
│   ├── settings/        # 規則配置 UI
│   ├── statistics/      # 統計顯示
│   └── strategy/        # 策略表元件
├── context/
│   ├── GameContext.tsx  # 全域遊戲狀態提供者
│   ├── gameReducer.ts   # 狀態管理邏輯
│   └── gameActions.ts   # Action 調度器
├── hooks/
│   ├── useAIPlayer.ts   # AI 遊戲循環編排
│   ├── useGameLogic.ts  # 核心遊戲邏輯（補牌、停牌等）
│   ├── useInterval.ts   # 穩健的間隔 Hook
│   └── useBreakpoint.ts # 響應式設計工具
├── lib/
│   ├── ai/              # AI 玩家邏輯和決策
│   ├── counting/        # 算牌實作
│   ├── dealer/          # 莊家 AI 邏輯
│   ├── deck/            # 卡牌和牌靴管理
│   ├── hand/            # 手牌評估邏輯
│   ├── rules/           # 賠付和規則計算
│   └── strategy/        # 基本策略表與偏差解析器
├── i18n/
│   ├── locales/         # 翻譯檔案（en, zh-TW, ko, fil）
│   └── config.ts        # i18n 配置
├── types/               # TypeScript 類型定義
└── constants/           # 遊戲常數和預設值
    └── strategies/      # 策略偏差定義（Illustrious 18, KO Preferred等）
```

## 快速開始

### 前置需求
- Node.js 16+
- npm 或 yarn

### 安裝

```bash
# 克隆專案
git clone https://github.com/mason276752/blackjack.git
cd blackjack

# 安裝依賴
npm install

# 啟動開發伺服器
npm run dev
```

應用程式將在 `http://localhost:5173` 上運行

### 生產環境構建

```bash
npm run build
```

### 預覽生產構建

```bash
npm run preview
```

### 執行測試

```bash
npm test
```

## 使用說明

### 手動遊玩

1. **配置規則**（可選）：點擊齒輪圖示自訂遊戲規則或選擇預設
2. **選擇算牌系統**（可選）：從標題區域選擇你偏好的算牌系統
3. **下注**：使用籌碼按鈕進行下注
4. **發牌**：點擊「發牌」開始回合
5. **做決策**：根據策略使用動作按鈕（補牌、停牌、加倍、分牌、投降）
6. **查看策略提示**：查看左側策略表獲得最佳遊玩建議
7. **追蹤計數**：在標題區域監控運行計數和真實計數
8. **策略偏差**：當計數達到閾值時，中央提示框會顯示偏差建議

### AI 自動遊玩

1. **啟動 AI**：在 AI 控制面板點擊「播放」按鈕 (▶)
2. **調整速度**：使用滑桿控制遊戲速度（50-2000ms）
3. **監控決策**：即時觀察 AI 的推理和統計數據
4. **暫停/繼續**：點擊「暫停」(⏸) 暫停，再點擊「播放」繼續
5. **停止 AI**：點擊「停止」(⏹) 完全停止並重置 AI 統計
6. **錯誤重試**：如果 AI 卡住，點擊錯誤顯示中的「重試」按鈕

## 遊戲規則

### 預設配置
- **牌組數**：6 副牌
- **莊家規則**：軟 17 停牌 (S17)
- **21點賠率**：3:2
- **加倍**：任意兩張牌
- **分牌後加倍**：允許
- **重新分牌**：最多 3 次（共 4 手牌）
- **重新分 A**：不允許
- **分 A 後補牌**：不允許
- **後期投降**：允許
- **保險**：莊家明牌為 A 時可用
- **滲透率**：75%（剩餘 1.5 副牌時重新洗牌）
- **起始資金**：$25,000
- **最小下注**：$25
- **最大下注**：$5,000

### 規則自訂
所有規則都可以通過設定面板自訂：
- 牌組數量（1-8 副牌）
- 莊家行為（軟 17 補牌/停牌）
- 21點賠率（6:5、3:2、2:1）
- 加倍限制
- 分牌/重新分牌規則
- 保險可用性
- 投降選項

### 金額四捨五入規則
遊戲採用**對玩家不利的四捨五入**策略，符合真實賭場慣例：
- **成本（玩家支付）**：向上取整（例：$25 下注的保險費為 $13，而非 $12）
- **賠付（玩家收取）**：向下取整（例：$27 下注的21點賠付為 $67，而非 $67.5）

**建議**：使用偶數金額下注（$50、$100、$200 等）以避免四捨五入損失。

## 算牌系統與策略偏差

### Hi-Lo + Illustrious 18（推薦初學者）
**點數分配**：
- **低牌 (2-6)**: +1
- **中性牌 (7-9)**: 0
- **高牌 (10-A)**: -1

**系統特性**：
- **類型**：平衡系統，需要轉換為真實計數
- **優點**：簡單易學，效果良好
- **下注相關性**：0.97
- **遊玩效率**：0.51

**策略偏差**：Illustrious 18（18個關鍵偏差）
- 保險：TC >= +3
- 16 vs 10 投降：TC >= 0
- 15 vs 10 停牌：TC >= +4
- ... （共18個偏差）

### KO + KO Preferred（無需轉換真實計數）
**點數分配**：
- **低牌 (2-7)**: +1
- **中性牌 (8-9)**: 0
- **高牌 (10-A)**: -1

**系統特性**：
- **類型**：不平衡系統，無需真實計數
- **優點**：比 Hi-Lo 更簡單，不需要計算剩餘牌組
- **下注相關性**：0.98
- **遊玩效率**：0.55

**策略偏差**：KO Preferred（14個優化偏差）
- 保險：RC >= +3
- 16 vs 10 停牌：Key Count (-4) 或以上
- 12 vs 4/5/6 補牌：IRC (-20) 或以下
- ... （共14個偏差）

### Omega II + Omega II Matrix（進階多級系統）
**點數分配**：
- **+2 牌 (4, 5)**: +2
- **+1 牌 (2, 3, 7)**: +1
- **中性牌 (8, 9, A)**: 0
- **-1 牌 (9)**: -1
- **-2 牌 (10, J, Q, K)**: -2

**系統特性**：
- **類型**：平衡多級系統
- **優點**：理論上最高準確度
- **缺點**：較複雜，需要更多練習
- **下注相關性**：0.99
- **遊玩效率**：0.67

**策略偏差**：Omega II Matrix（17個進階索引）
- 保險：TC >= +6（約為 Hi-Lo 的 2倍）
- 16 vs 10 停牌：TC >= 0
- 10 vs 10 加倍：TC >= +9
- ... （共17個偏差）

### Zen Count + Zen Indices（精確多級系統）
**點數分配**：
- **+2 牌 (4, 5, 6)**: +2
- **+1 牌 (2, 3, 7)**: +1
- **中性牌 (8, 9)**: 0
- **-1 牌 (A)**: -1
- **-2 牌 (10, J, Q, K)**: -2

**系統特性**：
- **類型**：平衡多級系統
- **優點**：精確度與複雜度平衡良好
- **下注相關性**：0.96
- **遊玩效率**：0.63

**策略偏差**：Zen Indices（21個精確索引）
- 保險：TC >= +3
- 16 vs 10 停牌：TC >= 0
- 11 vs A 加倍：TC >= +1
- ... （共21個偏差）

### CAC2 + Catch 22（Catch And Count 2）
**點數分配**：
- **+2 牌 (3, 4, 5)**: +2
- **+1 牌 (2, 6, 7)**: +1
- **中性牌 (8, 9)**: 0
- **-1 牌 (A)**: -1
- **-2 牌 (10, J, Q, K)**: -2

**系統特性**：
- **類型**：平衡多級系統
- **優點**：22個偏差提供全面覆蓋
- **下注相關性**：0.98
- **遊玩效率**：0.60

**策略偏差**：Catch 22（22個策略偏差）
- 保險：TC >= +3
- 16 vs 10 停牌：TC >= 0
- Soft 19 vs 5/6 加倍：TC >= +2/+1
- 8 vs 5/6 加倍：TC >= +3
- ... （共22個偏差）

## AI 下注策略

AI 使用基於真實計數的實用下注策略：

| 真實計數 | 下注單位 | 範例（$25 最小注）|
|----------|---------|-------------------|
| ≤ 0      | 1 單位  | $25              |
| +1       | 2 單位  | $50              |
| +2       | 4 單位  | $100             |
| +3       | 8 單位  | $200             |
| ≥ +4     | 12 單位 | $300             |

這個 1-12 單位的策略在獲利性和隱蔽性之間取得平衡，符合實際算牌實務。

## 🌍 多語言支援 (i18n)

### 支援的語言
- **English**（英文）
- **繁體中文**（Traditional Chinese）
- **한국어**（Korean / 韓文）
- **Filipino**（菲律賓語）

### 技術實作
- **i18next**：完整的國際化框架
- **語言偵測**：自動偵測瀏覽器語言
- **持久化**：語言選擇儲存在 localStorage
- **命名空間分離**：
  - `common`：共用 UI 文字
  - `game`：遊戲術語
  - `actions`：動作按鈕
  - `strategy`：策略表標籤
  - `stats`：統計標籤
  - `count`：算牌系統名稱
  - `hand`：手牌狀態
  - `betting`：下注 UI
  - `rules`：規則配置
  - `ai`：AI 控制面板

### 切換語言
使用標題右上角的語言切換器：
- 🇬🇧 English
- 🇹🇼 繁體中文
- 🇰🇷 한국어
- 🇵🇭 Filipino

### 添加新語言
1. 在 `src/i18n/locales/` 建立新語言資料夾（如 `ja/` 代表日文）
2. 複製現有翻譯檔案（`en/` 或 `zh-TW/`）
3. 翻譯所有命名空間的 JSON 檔案
4. 在 `src/i18n/config.ts` 註冊新語言
5. 更新語言切換器 UI

## 效能考量

- AI 最小速度限制為 50ms 以防止效能問題
- 在可配置的滲透率水平自動重新洗牌
- 使用 React.memo 和 useMemo 優化重新渲染
- 高效的卡牌精靈圖渲染

## 瀏覽器支援

- Chrome/Edge 90+
- Firefox 88+
- Safari 14+

## 故障排除

### AI 停止遊玩
- AI 內建卡死偵測（10 秒超時）
- 如果偵測到，會顯示錯誤訊息和「重試」按鈕
- 如果問題持續，點擊「停止」再點擊「播放」重新啟動

### 統計數據未更新
- 確保不在下注階段（統計在手牌結算後更新）
- 檢查瀏覽器控制台是否有錯誤

### 策略表未高亮
- 驗證處於玩家回合階段
- 檢查當前手牌有有效卡牌

### 保險無法拒絕
- 確保點擊「拒絕」按鈕（✕ 按鈕）
- 拒絕後 `insuranceBet` 設為 -1（已拒絕）

## 開發與部署

### GitHub Actions CI/CD
專案使用 GitHub Actions 自動化部署到 GitHub Pages：
- 自動執行測試套件
- 構建生產版本
- 部署到 GitHub Pages

### 本地開發
```bash
# 開發模式（熱重載）
npm run dev

# 類型檢查
npm run type-check

# Lint 檢查
npm run lint

# 執行測試
npm test

# 生產構建
npm run build
```

## 貢獻

這是個人專案，但歡迎建議和反饋。

## 授權

MIT License - 詳見 LICENSE 檔案

## 致謝

- 基本策略表基於 Edward Thorp 的數學分析
- 算牌系統來自《Beat the Dealer》等21點文獻
- Illustrious 18 由 Don Schlesinger 開發
- KO 系統來自《Knock-Out Blackjack》
- Omega II 由 Bryce Carlson 開發
- Zen Count 由 Arnold Snyder 開發
- UI 設計靈感來自現代賭場遊戲介面
- 撲克牌圖像來源：公開資源

## 版本歷史

### v2.0.0（最新）
- ✅ 5 種算牌系統（Hi-Lo, KO, Omega II, Zen Count, CAC2）
- ✅ 系統策略硬綁定（強制配對）
- ✅ 即時策略偏差提示
- ✅ Index Plays 面板
- ✅ 四語言支援（英文、繁中、韓文、菲律賓語）
- ✅ 策略表手動標籤控制（移除自動切換）
- ✅ 莊家手牌寬度優化（與玩家一致）
- ✅ 保險拒絕修復（-1 狀態標記）
- ✅ 策略提示高度增加（170px）

### v1.0.0
- ✅ 完整21點遊戲實作
- ✅ AI 自動遊玩系統
- ✅ 3 種算牌系統（Hi-Lo、KO、Omega II）
- ✅ 互動式策略表
- ✅ 雙語支援（繁體中文、英文）
- ✅ 保險功能
- ✅ 玩家不利四捨五入規則
- ✅ GitHub Pages 自動部署
- ✅ 完整測試覆蓋（104 個測試）

## 技術亮點

### 狀態管理
- React Context + useReducer 模式
- 不可變狀態更新
- 類型安全的 Actions 和 State

### AI 實作
- 基於基本策略表的決策引擎
- 真實計數導向的下注系統
- 策略偏差解析器（StrategyResolver）
- 三層卡死偵測和恢復機制
- 完整的統計追蹤

### 算牌與策略偏差
- 5 個算牌系統，每個有專屬策略集
- 統一的 `StrategyDeviation` 格式
- 平衡/不平衡系統自動處理（TC/RC）
- 編譯時強制系統策略配對

### 國際化
- i18next 完整整合
- 語言偵測和持久化
- 命名空間分離（common、game、ai、rules 等）
- 四語言完整覆蓋

### 測試
- Jest 單元測試
- 賠付計算測試
- 算牌系統測試
- AI 決策邏輯測試
- StrategyResolver 測試

---

**開發者**：Mason
**專案連結**：[GitHub Repository](https://github.com/mason276752/blackjack)
**線上展示**：[Play Now](https://mason276752.github.io/blackjack/)
